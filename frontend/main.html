<!DOCTYPE html>
<html lang="ru">
    <head>
        <title>Главная страница</title>
        <script src="./api.js"></script>
    </head>

    <body>
        <h1>Главная страница</h1>
        <div >
            <p id="username"></p>
            <p id="token"></p>
            <p id="error" style="color: red;"></p>           
        </div>
        <div>
            <button onclick="cont()" id="ContinueButton" class="ContinueButton">продолжить</button><br>
            <button onclick="info()" id="infbt">информация</button><br>
            <button onclick="logout()">Выход</button>
        </div>
<script>
    const authData = JSON.parse(sessionStorage.getItem('authData'));
    const errorElement = document.getElementById('error');
    const usernameElement = document.getElementById('username');
    const tokenElement = document.getElementById('token');
    const continueButton = document.getElementById('ContinueButton');
    const infoButton = document.getElementById('infbt');
  
    if (!authData) {
        errorElement.textContent = 'Сессия не найдена';
        usernameElement.style.display = 'none';
        tokenElement.style.display = 'none';
        continueButton.style.display = 'none';
        infoButton.style.display = 'none';
        setTimeout(() => window.location.href = 'index.html', 2000);
    } else {
        const now = Date.now();
        const EXPIRY_MS = 20000;
    
        if (now - authData.authDate > EXPIRY_MS) {
            errorElement.textContent = 'Срок действия токена истёк';
            usernameElement.style.display = 'none';
            tokenElement.style.display = 'none';
            continueButton.style.display = 'block';
            infoButton.style.display = 'none';                                      
            sessionStorage.setItem('reauthUsername', authData.username);
        } else {
            usernameElement.textContent = `User: ${authData.username}`;
            tokenElement.textContent = `Token: ${authData.token}`;
            continueButton.style.display = 'none';
            infoButton.style.display = 'block';
        }
    }

    function logout() {
        sessionStorage.clear();
        window.location.href = 'index.html';
    }

    function info() {
        window.location.href = 'information.html';
    }

    function cont() {
        sessionStorage.removeItem('authData');
        window.location.href = 'oldtokenwindow.html';
    s}
</script>     
    </body>

    <style>
        body 
        {
            margin: 0;
            color: goldenrod;
            background-color: rgb(56, 54, 54);
            font-size: 24px;
            justify-content: center;
            justify-items: center;
        }
        p
        {
            color: blueviolet;
            justify-content: center;
            justify-items: center;
            word-break: break-all;
        }
        button 
        {
            background-color: aqua;
            width: 177px;
            justify-content: center;
            justify-items: center;
        }
        div
        {
            justify-content: center;
            justify-items: center;
        }
        .ContinueButton
        {
            visibility: collapse;
        }
    </style>
</html>